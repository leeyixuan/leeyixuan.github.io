---
layout:     post
title:      "JSä¸­çš„å­—ç¬¦å¤„ç†"
subtitle:   ""
date:       2018-8-12
author:     "leeyixuan"
header-img: "img/background/post-bg-js.jpg"
tags:
    - js
---
## Unicodeå’ŒUCS
Unicodeå’ŒUCSç¼–ç æ˜¯ä¸¤ä¸ªä¸åŒçš„å›½é™…åŒ–ç»„ç»‡å‘å¸ƒçš„å­—ç¬¦é›†æ ‡å‡†ã€‚
Unicodeå’ŒUCSå¯ä»¥å®¹çº³å…¨ä¸–ç•Œæ‰€æœ‰çš„æ–‡å­—å­—ç¬¦ï¼Œå¹¶å¯¹å®ƒä»¬ç»Ÿä¸€è¿›è¡Œç¼–ç ï¼Œè®©æ¯ä¸€ä¸ªå­—ç¬¦éƒ½å¯¹åº”ä¸€ä¸ªä¸åŒçš„ç¼–ç å€¼ã€‚
ä¸ºäº†å…¼å®¹ï¼Œåˆ°Unicode2.0æ—¶ï¼ŒUnicodeå’ŒUCSçš„å­—ç¬¦é›†åŸºæœ¬ä¸€è‡´ã€‚
>`å­—ç¬¦é›†`å¯ä»¥ç†è§£ä¸ºç”±è‹¥å¹²ä¸ª`ç ç‚¹-å­—ç¬¦å¯¹`æ„æˆçš„é›†åˆã€‚ç ç‚¹å°±æ˜¯ä¸€ä¸²æ•°å­—IDï¼Œæ ‡è¯†ä¸åŒçš„å­—ç¬¦ã€‚

>è¿™é‡Œæè¿°çš„`å­—ç¬¦é›†åŸºæœ¬ä¸€è‡´`æ˜¯æŒ‡ï¼š
>1. ç ç‚¹å’Œå­—ç¬¦çš„æ˜ å°„å…³ç³»æ˜¯ç›¸åŒçš„ï¼Œå³åŒä¸€ä¸ªç ç‚¹å€¼åœ¨ä¸åŒçš„æ ‡å‡†ä¸­å¯¹åº”çš„å­—ç¬¦æ˜¯ç›¸åŒçš„ã€‚
>2. æ‰€åŒ…å«çš„å­—ç¬¦æ•°ç›¸åŒï¼ŒåŒ…å«ç ç‚¹èŒƒå›´ï¼šU+000000åˆ°U+10FFFFã€‚å…¶ä¸­U+0000åˆ°U+FFFFèŒƒå›´çš„ç ç‚¹ï¼Œç§°ä¸ºåŸºæœ¬å¹³é¢å†…ï¼ŒBMPï¼Œå­˜æ”¾æœ€å¸¸è§çš„å­—ç¬¦ã€‚åœ¨U+010000åˆ°U+10FFFFèŒƒå›´çš„ç ç‚¹ï¼Œç§°ä¸ºè¾…åŠ©å¹³é¢å†…ï¼ŒSMPã€‚

Unicodeå’ŒUCSçš„åŒºåˆ«ä¸»è¦ä½“ç°åœ¨ä»–ä»¬å„ç§å®ç°çš„ç¼–ç èŒƒæ–¹å¼ã€‚

Unicodeæœ‰ä¸‰ç§ç¼–ç æ–¹å¼ï¼š
- UTF-8ï¼š1-4å­—èŠ‚å˜é•¿ç¼–ç ï¼Œè¦†ç›–BMP+SMPã€‚è¿™ç§ç¼–ç æœ€ä¸ºå¸¸è§ï¼Œä¸€æ˜¯å› ä¸ºä»–æ˜¯1-4å­—èŠ‚å˜é•¿ç¼–ç èŠ‚çœç©ºé—´ï¼Œè€Œæ˜¯ä»–å®Œå…¨å…¼å®¹ASCIIç¼–ç ã€‚
- UTF-16ï¼š2-4å­—èŠ‚ç¼–ç ï¼Œè¦†ç›–BMP+SMPã€‚åœ¨BMPï¼Œä½¿ç”¨2å­—èŠ‚ç¼–ç ï¼›åœ¨SMPï¼Œä½¿ç”¨4å­—èŠ‚ç¼–ç ã€‚
- UTF-32ï¼š4å­—èŠ‚ç¼–ç ï¼Œè¦†ç›–BMP+SMPã€‚

UCSæœ‰ä¸¤ç§ç¼–ç æ–¹å¼ï¼š
- UCS-2ï¼š2å­—èŠ‚ç¼–ç ï¼Œåªè¦†ç›–BMPã€‚UCS-2å¯ä»¥è§†ä½œæ˜¯UTF-16çš„å­é›†ã€‚
- UCS-4ï¼š4å­—èŠ‚ç¼–ç ï¼Œè¦†ç›–BMP+SMPã€‚UTF-32æ˜¯UCS-4çš„ä¸€ä¸ªå­é›†ã€‚


## Javascriptä½¿ç”¨UCS-2ç¼–ç 


>å› ä¸ºUnicodeå’ŒUCSçš„å­—ç¬¦é›†åŸºæœ¬ä¸€è‡´ï¼Œæ‰€ä»¥ä¹Ÿç»å¸¸è§åˆ°`JavaScript ä½¿ç”¨ Unicode å­—ç¬¦é›†`è¿™æ ·çš„æè¿°ã€‚

JavaScriptä½¿ç”¨UCS-2ç¼–ç ã€‚ç”±äºUCS-2åªè¦†ç›–BMPï¼Œä½¿ç”¨2å­—èŠ‚ç¼–ç ã€‚äºæ˜¯JavaScripté»˜è®¤å­—ç¬¦éƒ½æ˜¯2ä¸ªå­—èŠ‚ã€‚é’ˆå¯¹SMPçš„å­—ç¬¦ï¼Œåœ¨UCS-2æ— æ³•è¯†åˆ«ï¼Œä¼šæŠŠä¸€ä¸ª4å­—èŠ‚çš„å­—ç¬¦æ‹†è§£ä¸ºä¸¤ä¸ª2å­—èŠ‚çš„å­—ç¬¦ï¼Œäº§ç”Ÿé”™è¯¯ã€‚JavaScriptå­—ç¬¦å¤„ç†å‡ºé”™çš„æœ¬è´¨åŸå› å°±æ˜¯ç”±äºæ­¤ã€‚


## ES5ä¸­çš„å­—ç¬¦å¤„ç†
### 1. `\uxxxx`
ES5å…è®¸ç›´æ¥åœ¨ç¨‹åºä¸­ä½¿ç”¨ Unicode ç ç‚¹è¡¨ç¤ºå­—ç¬¦ï¼Œå³å°†å­—ç¬¦å†™æˆ`\uxxxx`çš„å½¢å¼ã€‚æ¯”å¦‚ï¼š`var s = '\u00A9'; // "Â©"`

æ³¨æ„ï¼š
- ç ç‚¹å€¼ä½¿ç”¨4ä¸º16è¿›åˆ¶æ•°è¡¨ç¤ºï¼Œä¸å¤Ÿ4ä½çš„ä½¿ç”¨0è¡¥è¶³ï¼Œä¸èƒ½å¸¦0xçš„å‰ç¼€ã€‚
- å¯¹äºç ç‚¹åœ¨SMPçš„å­—ç¬¦ï¼Œé•¿åº¦ä¸º32ä½ï¼ˆéœ€è¦6ä½16è¿›åˆ¶æ•°æ‰èƒ½è¡¨ç¤ºï¼‰ï¼Œè¦å°†å…¶æ‹†ä¸ºä¸¤ä¸ª4ä½16è¿›åˆ¶æ•°ã€‚æ¯”å¦‚ï¼š`\u01D306`æ‹†è§£ä½`\uD834\uDF06`ã€‚


### 2. String.fromCharCode()
String.fromCharCode()æ–¹æ³•å¯ä»¥è¾¾åˆ°å’Œ`\uxxxx`ä¸€æ ·çš„ç›®çš„ï¼Œå³å¯ä»¥é€šè¿‡Unicode ç ç‚¹è¿”å›å¯¹åº”çš„å­—ç¬¦ã€‚

- è¾“å…¥ï¼šé»˜è®¤åè¿›åˆ¶ç ç‚¹å€¼ï¼›ä¹Ÿå¯ä»¥ä½¿ç”¨16è¿›åˆ¶æ•°ç ç‚¹å€¼ï¼Œä½†æ˜¯è¦å¸¦0xå‰ç¼€ã€‚`String.fromCharCode(0x61)`ç­‰äº`String.fromCharCode(97)`
- è¿”å›ï¼šå¯¹åº”å­—ç¬¦
`String.fromCharCode(97) // "a"`
- æ³¨æ„ï¼šè¯¥æ–¹æ³•ä¸æ”¯æŒ Unicode ç ç‚¹å¤§äº0xFFFFçš„å­—ç¬¦ï¼Œå³ä¼ å…¥çš„å‚æ•°ä¸èƒ½å¤§äº0xFFFFï¼ˆå³åè¿›åˆ¶çš„ 65535ï¼‰ã€‚ç ç‚¹å¤§äº0xFFFFçš„å­—ç¬¦å ç”¨å››ä¸ªå­—èŠ‚ï¼Œå¿…é¡»æŠŠå­—ç¬¦æ‹†æˆä¸¤ä¸ªå­—ç¬¦è¡¨ç¤ºã€‚`String.fromCharCode(55357, 56489); //"ğŸ’©"`

### 3. String.prototype.charCodeAt() 

ES5è¿˜æä¾›ä¸€ä¸ªå¯ä»¥æ ¹æ®å­—ç¬¦è·å–ç ç‚¹çš„å‡½æ•°ï¼ŒString.fromCharCode()çš„é€†æ–¹æ³•â€”â€”String.prototype.charCodeAt() 
- å‚æ•°ï¼šå­—ç¬¦ä¸²æŒ‡å®šä½ç½®çš„ç´¢å¼•
- è¿”å›ï¼šå¯¹åº”å­—ç¬¦çš„Unicode ç ç‚¹ï¼ˆåè¿›åˆ¶è¡¨ç¤ºï¼‰
- æ³¨æ„ï¼šè¿”å›çš„ Unicode ç ç‚¹ä¸ä¼šå¤§äº65536ï¼ˆ0xFFFFï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¿”å›ä¸¤ä¸ªå­—èŠ‚çš„å­—ç¬¦çš„ç ç‚¹ã€‚å¦‚æœé‡åˆ°ç ç‚¹å¤§äº 65536 çš„å­—ç¬¦ï¼ˆå››ä¸ªå­—èŠ‚çš„å­—ç¬¦ï¼‰ï¼Œå¿…éœ€è¿ç»­ä½¿ç”¨ä¸¤æ¬¡charCodeAtã€‚
```javascript
'ğŸ’©'.charCodeAt(0); //55357  
'ğŸ’©'.charCodeAt(1); // 56489
```

String.prototype.charCodeAt() è¿”å›çš„æ˜¯ç ç‚¹çš„åè¿›åˆ¶å€¼ï¼Œå¦‚æœæƒ³è¦åå…­è¿›åˆ¶çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨toStringæ–¹æ³•è½¬æ¢ä¸€ä¸‹ã€‚
`'a'.charCodeAt().toString(16); //61`

## ES6ä¸­çš„å­—ç¬¦å¤„ç†
### 1. `\u{xxxx}`
æ‹“å±•äº†`\uxxxx`è¡¨è¾¾æ³•ï¼Œå˜æˆ`\u{xxxx}`
è™½ç„¶ç ç‚¹å€¼è¿˜æ˜¯åªæ”¯æŒ16è¿›åˆ¶æ•°ï¼Œä½†æ˜¯ä¸ä¸€å®šè¦ä½¿ç”¨4ä½è¡¨ç¤ºï¼Œä¸å¤Ÿ4ä½çš„ä¸ç”¨è¡¥è¶³ï¼Œè¶…è¿‡4ä½çš„ä¸ç”¨æ‹†è§£ä¸ºä¸¤ä¸ªï¼Œéƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚
```javascript
'\u{61}'; //'a'
'\u{128169}'; // 'ğŸ’©'
```
### 2. String.fromCodePoint()
String.fromCodePoint()æ–¹æ³•å¯ä»¥è¾¾åˆ°å’Œ`\u{xxxx}`ä¸€æ ·çš„ç›®çš„ï¼Œå³å¯ä»¥é€šè¿‡Unicode ç ç‚¹è¿”å›å¯¹åº”çš„å­—ç¬¦ã€‚å’ŒString.fromCharCode()ä¸åŒçš„æ˜¯ï¼Œè¯¥æ–¹æ³•è¿˜æ”¯æŒ Unicode ç ç‚¹å¤§äº0xFFFFçš„å­—ç¬¦ã€‚

`String.fromCodePoint(128169); //"ğŸ’©" `



### 3. String.prototype.codePointAt() 
ES5è¿˜æä¾›ä¸€ä¸ªå¯ä»¥æ ¹æ®å­—ç¬¦è·å–ç ç‚¹çš„å‡½æ•°ï¼ŒString.fromCodePoint()çš„é€†æ–¹æ³•â€”â€”String.prototype.codePointAt() ã€‚å’ŒString.prototype.charCodeAt() ä¸åŒçš„æ˜¯ï¼Œè¯¥æ–¹æ³•èƒ½å¤Ÿæ­£ç¡®å¤„ç† 4 ä¸ªå­—èŠ‚å‚¨å­˜çš„å­—ç¬¦ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦çš„ç ç‚¹ã€‚

`"ğŸ’©".codePointAt(); //128169`


### 4. for...of
ES6 ä¸ºå­—ç¬¦ä¸²æ·»åŠ äº†éå†å™¨æ¥å£ï¼Œä½¿å¾—å­—ç¬¦ä¸²å¯ä»¥è¢«for...ofå¾ªç¯éå†ã€‚é™¤äº†éå†å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªéå†å™¨æœ€å¤§çš„ä¼˜ç‚¹æ˜¯å¯ä»¥è¯†åˆ«å¤§äº0xFFFFçš„ç ç‚¹ï¼Œä¼ ç»Ÿçš„forå¾ªç¯æ— æ³•è¯†åˆ«è¿™æ ·çš„ç ç‚¹ã€‚

### 5. Array.from()
è¯¥æ¥å£å¯ä»¥è¯†åˆ«å¤§äº0xFFFFçš„ç ç‚¹ï¼Œåœ¨é€‚å½“çš„åœ°æ–¹åˆ†å‰²å­—ç¬¦ã€‚
å¯ä»¥åªç”¨Array.from()å°†å­—ç¬¦ä¸²è½¬æ¢æˆæ•°ç»„ï¼Œå†æ±‚lengthã€‚



## JavaScriptå­—ç¬¦è§£ç çš„æ˜“é”™ç‚¹                                 
æ˜“é”™ç‚¹1.åˆ¤æ–­å­—é•¿å‡ºé”™ã€‚    
`>â€ğŸ’©â€.length;  //2`    
è§£å†³åŠæ³•ï¼š   
`Array.from('ğŸ’©').length; //1`

æ˜“é”™ç‚¹2.è¯»å–å­—ç¬¦ä¸²å‡ºé”™   
`'ä¸€å¨ğŸ’©'.split(''); //["ä¸€", "å¨", "ï¿½", "ï¿½"]`   
è§£å†³åŠæ³•ï¼š    
`Array.from('ğŸ’©'); //["ğŸ’©"]`

æ˜“é”™ç‚¹3.ç ç‚¹å­—ç¬¦ä¸²è½¬æ¢å‡ºé”™     
`String.fromCharCode(128169); //"ï’©"`    
`"ğŸ’©".charCodeAt(); //55357`     
è§£å†³åŠæ³•ï¼š    
`String.fromCodePoint(128169); //"ğŸ’©" `     
`"ğŸ’©".codePointAt(); //128169`   

æ˜“é”™ç‚¹4.æ­£åˆ™åŒ¹é…å‡ºé”™     
`/foo.bar/.test('fooğŸ’©bar');   //false`     
è§£å†³åŠæ³•ï¼š     
å¢åŠ ä¸€ä¸ªuæ ‡å¿—ï¼Œ`/foo.bar/u.test('fooğŸ’©bar');  //true`

**æ€»ç»“**ï¼šå°½é‡ä½¿ç”¨ES6è¯­æ³•é¿å…å‡ºé”™ 
- `\u{ç ç‚¹å€¼}` ï¼Œé¿å…4å­—èŠ‚ç ç‚¹å€¼è¢«æ‹†è§£
- å­—ç¬¦ä¸²çš„lengthå±æ€§è¿˜æ˜¯ç”¨åŒå­—èŠ‚åˆ¤æ–­çš„ï¼Œæ‰€ä»¥åˆ¤æ–­é•¿åº¦è¦ç”¨`Array.from(str).length` 
-  éå†å­—ç¬¦ä¸²ä½¿ç”¨`for(let s of str) {}`
-  ä½¿ç”¨`String.fromCodePoint`å’Œ`string.codePointAt()`è·å¾—å­—ç¬¦ä¸²å’Œç ç‚¹å€¼


## reference
1. [unicodeå’Œucsçš„åŒºåˆ«](https://blog.csdn.net/ultrani/article/details/8432767)
2. [ç»†è¯´ï¼šUnicode, UTF-8, UTF-16, UTF-32, UCS-2, UCS-4](https://www.cnblogs.com/malecrab/p/5300503.html)
3. [Javascriptæœ‰ä¸ªUnicodeçš„å¤©å‘ - AlloyTeam](http://www.alloyteam.com/2016/12/javascript-has-a-unicode-sinkhole/)
4. [å­—ç¬¦ä¸²çš„æ‰©å±• - ECMAScript 6å…¥é—¨](http://es6.ruanyifeng.com/#docs/string#codePointAt)
5. [String å¯¹è±¡ - JavaScript ](https://wangdoc.com/javascript/stdlib/string.html#stringfromcharcode)